
INHERITS CTagv2Frame

STATIC PRIVATE ENC AS String[] = ["ISO-8859-1", "UTF-16", "UTF-16", "UTF-8"]
STATIC PRIVATE ENC_Split AS NEW String[]

PUBLIC CONST encISO AS Integer = &H00 ' text-encoding ISO-8859-1 is used
PUBLIC CONST encUTF16BOM AS Integer = &H01 ' text-encoding UTF-16-BOM is used
PUBLIC CONST encUTF16 AS Integer = &H02 ' text-encoding UTF-16 is used
PUBLIC CONST encUTF8 AS Integer = &H03 ' text-encoding UTF-8 is used

STATIC PROPERTY READ encString AS String[] ' returns the identifier of the text-encoding
STATIC PROPERTY READ encSplit AS String[] ' returns the character needed for string-separation

PROPERTY encoding AS Integer ' returns the text-encoding used in the frame

PROPERTY READ id AS String ' returns the frame-ID
PROPERTY content AS String[] ' returns the content of the text-frame, description first

PRIVATE $content AS String[]
PRIVATE $encoding AS Integer

PUBLIC SUB _new(OPTIONAL rawData AS String = NULL)
  
  DIM t AS String
  DIM tmp2 AS String[]
  
  IF IsNull(rawData) THEN 
    $encoding = CTagv2FrameText.encUTF8
    tmp2 = [rawData]
  ELSE
    $encoding = CByte(Asc(rawData))
    t = Conv(Mid(rawData, 2), System.Charset, Desktop.Charset)
    tmp2 = Split(t, CTagv2FrameText.encSplit[$encoding])
  END IF
  $content = tmp2
  
END 

PUBLIC SUB _free()
  $content = NULL
END

STATIC PUBLIC SUB _exit()
  ENC = NULL
  ENC_Split = NULL
END

STATIC PRIVATE FUNCTION encString_Read() AS String[]
  RETURN ENC
END
STATIC PRIVATE FUNCTION encSplit_Read() AS String[]
  RETURN ENC_Split
END
PRIVATE FUNCTION id_Read() AS String
  RETURN SUPER.header.id
END
PRIVATE FUNCTION content_Read() AS String[]
  RETURN $content
END
PRIVATE SUB content_Write(Value AS String[])
  $content = Value
END
PRIVATE FUNCTION encoding_Read() AS Integer
  RETURN $encoding
END
PRIVATE SUB encoding_Write(Value AS Integer)
  $encoding = Value
END


STATIC PUBLIC SUB _init()
  
  CTagv2Frame.FTypes.Add("Album/Movie/Show title", "TALB")
  CTagv2Frame.FTypes.Add("BPM (beats per Minute)", "TBPM")
  CTagv2Frame.FTypes.Add("Composer", "TCOM")
  CTagv2Frame.FTypes.Add("Content type", "TCON")
  CTagv2Frame.FTypes.Add("Copyright message", "TCOP")
  CTagv2Frame.FTypes.Add("Encoding Time", "TDEN")
  CTagv2Frame.FTypes.Add("Playlist delay", "TDLY")
  CTagv2Frame.FTypes.Add("Original release Time", "TDOR")
  CTagv2Frame.FTypes.Add("Recording Time", "TDRC")
  CTagv2Frame.FTypes.Add("Release Time", "TDRL")
  CTagv2Frame.FTypes.Add("Tagging Time", "TDTG")
  CTagv2Frame.FTypes.Add("Encoded by", "TENC")
  CTagv2Frame.FTypes.Add("Lyricist/Text writer", "TEXT")
  CTagv2Frame.FTypes.Add("File type", "TFLT")
  CTagv2Frame.FTypes.Add("Involved people list", "TIPL")
  CTagv2Frame.FTypes.Add("Content group description", "TIT1")
  CTagv2Frame.FTypes.Add("Title/songname/content description", "TIT2")
  CTagv2Frame.FTypes.Add("Subtitle/Description refinement", "TIT3")
  CTagv2Frame.FTypes.Add("Initial key", "TKEY")
  CTagv2Frame.FTypes.Add("Language(s)", "TLAN")
  CTagv2Frame.FTypes.Add("Length", "TLEN")
  CTagv2Frame.FTypes.Add("Musician credits list", "TMCL")
  CTagv2Frame.FTypes.Add("Media type", "TMED")
  CTagv2Frame.FTypes.Add("Mood", "TMOO")
  CTagv2Frame.FTypes.Add("Original album/movie/show title", "TOAL")
  CTagv2Frame.FTypes.Add("Original filename", "TOFN")
  CTagv2Frame.FTypes.Add("Original lyricist(s) / text writer(s)", "TOLY")
  CTagv2Frame.FTypes.Add("Original artist(s)/performer(s)", "TOPE")
  CTagv2Frame.FTypes.Add("File owner/licensee", "TOWN")
  CTagv2Frame.FTypes.Add("Lead performer(s)/Soloist(s)", "TPE1")
  CTagv2Frame.FTypes.Add("Band/orchestra/accompaniment", "TPE2")
  CTagv2Frame.FTypes.Add("Conductor/performer refinement", "TPE3")
  CTagv2Frame.FTypes.Add("Interpreted, remixed, or otherwise modified by", "TPE4")
  CTagv2Frame.FTypes.Add("Part of a set", "TPOS")
  CTagv2Frame.FTypes.Add("Produced notice", "TPRO")
  CTagv2Frame.FTypes.Add("Publisher", "TPUB")
  CTagv2Frame.FTypes.Add("Track number / Position in set", "TRCK")
  CTagv2Frame.FTypes.Add("Internet radio station name", "TRSN")
  CTagv2Frame.FTypes.Add("Internet radio station owner", "TRSO")
  CTagv2Frame.FTypes.Add("Album sort order", "TSOA")
  CTagv2Frame.FTypes.Add("Performer sort order", "TSOP")
  CTagv2Frame.FTypes.Add("Title sort order", "TSOT")
  CTagv2Frame.FTypes.Add("ISRC (international standard recording code)", "TSRC")
  CTagv2Frame.FTypes.Add("Software/Hardware and settings used for encoding", "TSSE")
  CTagv2Frame.FTypes.Add("Set subtitle", "TSST")
  CTagv2Frame.FTypes.Add("User defined text information frame", "TXXX")
  
  ENC_Split.Add(Conv(Chr(0), Desktop.Charset, ENC[encISO]))
  ENC_Split.Add(Conv(Chr(0), Desktop.Charset, ENC[encUTF16BOM]))
  ENC_Split.Add(Conv(Chr(0), Desktop.Charset, ENC[encUTF16]))
  ENC_Split.Add(Conv(Chr(0), Desktop.Charset, ENC[encUTF8]))
  
END
